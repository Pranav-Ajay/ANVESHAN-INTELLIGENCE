<!DOCTYPE html>
<html>
<head>
  <title>ANVESHAN INTELLIGENCE</title>
</head>

<body>

<div style="width:450px; height:1000px; background-color:#215F9A; left:0; top:0; position:fixed;">
  <img width="400" height="400" src="AI.png">
  <div style="margin-left:20px;">
    <h2 style="color:white;">History</h2>
    <ol id="y"></ol>
  </div>
</div>

<div style="width:450px; height:1000px; background-color:#215F9A; right:0; top:0; position:fixed;">
  <div style="right:7%; top:10%; position:fixed;">
    <img id="ds" width=200 height=250><br><br><br><br>
    Name:<p id="k"></p><br><br>
    Contact:<p id="l"></p><br><br>
    Email:<p id="m"></p><br><br>
    Signature:<br><br><img id="de" width=200 height=100>
  </div>
</div>

<div style="position:fixed; bottom:5%; right:30%;">
  <!-- CHANGED ID HERE -->
  <input id="chatInput" style="width:600px; background-color:#BDC7D1; padding:10px; border-radius:20px;">
  <button onclick="execute()">â†’</button>
</div>

<div style="bottom:0; position:fixed; left:0;width:100%;background-color:blue;color:white;display:flex;justify-content:center;align-items:center;padding:10px;text-align:center;">
  Anveshan Intelligence can make mistakes, please use it carefully.
</div>

<div style="display:flex; justify-content:center;">
  <div class="x" style="width:600px; display:flex; flex-direction:column; gap:30px; margin-top:50px; height:800px">

    <div style="display:flex; flex-direction:column;">
      <h2>Hi, please fill out these details</h2>

      <ol id="details">

        <li>Complainant Name: <input id="complainantName"></li>
        <li>Father/Husband Name: <input></li>
        <li>DOB: <input type="date" id="dob"></li>
        <li>Nationality: <input></li>
        <li>Occupation: <input></li>
        <li>Age: <input type="number" id="age"></li>
        <li>Gender:
          <select>
            <option value="">Select</option>
            <option>Male</option>
            <option>Female</option>
            <option>Other</option>
          </select>
        </li>
        <li>Address: <input></li>
        <li>Phone/Email: <input></li>
        <li>Holiday:
          <select id="holiday">
            <option value="">Select</option>
            <option>yes</option>
            <option>no</option>
          </select>
        </li>
        <li>Holiday Name: <input></li>
        <li>Festival:
          <select id="festival">
            <option value="">Select</option>
            <option>yes</option>
            <option>no</option>
          </select>
        </li>
        <li>Festival Name: <input></li>
        <li>Weapon Used: <input id="weaponUsed"></li>
        <li>Date: <input type="date" id="date"></li>
        <li>Start Time: <input type="time" id="startTime"></li>
        <li>End Time: <input type="time" id="endTime"></li>
        <li>Time (Morning/Afternoon...): <input></li>
        <li>Place of Incident: <input></li>
        <li>Location of Incident: <input id="location"></li>
        <li>Type of Incident: <input id="incidentType"></li>

      </ol>

      <button onclick="check()">SUBMIT</button>

    </div>

  </div>
</div>

<script>

/* ================= PROFILE LOAD ================= */

let profileImg = document.getElementById("ds");
profileImg.src = localStorage.getItem("profilePic");

let signImg = document.getElementById("de");
signImg.src = localStorage.getItem("signaturePic");

document.getElementById("k").innerText = localStorage.getItem("username1");
document.getElementById("l").innerText = localStorage.getItem("username2");
document.getElementById("m").innerText = localStorage.getItem("username4");

/* ================= TCI CHECK FUNCTION ================= */

function check() {

  let inputs = document.querySelectorAll("#details input, #details select");
  let allFilled = true;

  inputs.forEach(function(input) {
    if (input.value.trim() === "") {
      input.style.border = "2px solid red";
      allFilled = false;
    } else {
      input.style.border = "";
    }
  });

  if (!allFilled) return;

  let result = answer();

  let container = document.querySelector(".x");

  let botDiv = document.createElement("div");
  botDiv.style.display = "flex";
  botDiv.style.justifyContent = "flex-start";

  let botText = document.createElement("pre");
  botText.innerText =
    "TCI RESULT\n" +
    "Status: " + result.status + "\n" +
    "Score: " + result.consistencyScore + "%\n" +
    "Issues: " +
    (result.inconsistenciesFound.length
      ? result.inconsistenciesFound.join(", ")
      : "None");

  botDiv.appendChild(botText);
  container.appendChild(botDiv);

  /* Ask victim status */
  let statusDiv = document.createElement("div");
  statusDiv.style.display = "flex";
  statusDiv.style.justifyContent = "flex-start";

  let statusText = document.createElement("h2");
  statusText.innerText = "Is the victim alive?";

  statusDiv.appendChild(statusText);
  container.appendChild(statusDiv);
}

/* ================= TCI MODEL ================= */

function answer() {

  const data = {
    complainantName: document.querySelector("#details li:nth-child(1) input")?.value || "",
    dob: document.querySelector("#details li:nth-child(3) input")?.value || "",
    age: document.querySelector("#details li:nth-child(6) input")?.value || "",
    date: document.querySelector("#details li:nth-child(15) input")?.value || "",
    startTime: document.querySelector("#details li:nth-child(16) input")?.value || "",
    endTime: document.querySelector("#details li:nth-child(17) input")?.value || "",
    weaponUsed: document.querySelector("#details li:nth-child(14) input")?.value || "",
    incidentType: document.querySelector("#details li:nth-child(20) input")?.value || "",
    location: document.querySelector("#details li:nth-child(19) input")?.value || ""
  };

  let inconsistencies = [];
  let confidenceScore = 100;

  /* Age validation */
  if (data.dob && data.age) {
    const birthYear = new Date(data.dob).getFullYear();
    const currentYear = new Date().getFullYear();
    const calculatedAge = currentYear - birthYear;

    if (Math.abs(calculatedAge - parseInt(data.age)) > 1) {
      inconsistencies.push("Age does not match DOB.");
      confidenceScore -= 15;
    }
  }

  /* Time validation */
  if (data.startTime && data.endTime && data.startTime > data.endTime) {
    inconsistencies.push("Start time is later than End time.");
    confidenceScore -= 20;
  }

  if (!data.incidentType) {
    inconsistencies.push("Incident type missing.");
    confidenceScore -= 15;
  }

  if (!data.location) {
    inconsistencies.push("Location missing.");
    confidenceScore -= 15;
  }

  if (!data.date) {
    inconsistencies.push("Incident date missing.");
    confidenceScore -= 15;
  }

  return {
    model: "TCI - Internal Consistency",
    extractedData: data,
    inconsistenciesFound: inconsistencies,
    consistencyScore: confidenceScore,
    status:
      inconsistencies.length === 0
        ? "Internally Consistent"
        : "Inconsistencies Detected"
  };
}

/* ================= CHAT SYSTEM ================= */

function execute() {

  let container = document.querySelector(".x");
  let inputValue = document.getElementById("chatInput").value.trim().toLowerCase();

  if (!inputValue) return;

  let userDiv = document.createElement("div");
  userDiv.style.display = "flex";
  userDiv.style.justifyContent = "flex-end";

  let userText = document.createElement("h2");
  userText.innerText = inputValue;

  userDiv.appendChild(userText);
  container.appendChild(userDiv);

  let botDiv = document.createElement("div");
  botDiv.style.display = "flex";
  botDiv.style.justifyContent = "flex-start";

  let botText = document.createElement("h2");

  if (inputValue === "yes") {
    botText.innerText = "Ok, please give victim's statement.";
  } 
  else if (inputValue === "no") {
    botText.innerText = "Proceed to evidence collection.";
  } 
  else {
    botText.innerText = "Please answer yes or no.";
  }

  botDiv.appendChild(botText);
  container.appendChild(botDiv);

  document.getElementById("chatInput").value = "";
}

/* ================= DELETE CHAT ================= */

function ask() {
  let outcome = confirm("Are you sure you want to delete this chat?");
  if (outcome) window.location.href = "chatbot.html";
}

/* ================= LOGOUT ================= */

function logout() {
  let res = confirm("Are you sure you want to log out?");
  if (res) {
    localStorage.clear();
    window.location.href = "index.html";
  }
}

</script>
